(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function l(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(r){if(r.ep)return;r.ep=!0;const s=l(r);fetch(r.href,s)}})();const a=document.getElementsByTagName("canvas").item(0),f=a.getContext("2d");let e=[[0,0]],g=0,P=performance.now();const x=document.getElementById("fps");let h=3;const i=25;let c="up";function T(n,o,l,t,r){switch(r){case"up":return n[1]-o<0?[n[0],t-Math.abs(n[1]-o)%t]:[n[0],Math.abs(n[1]-o)%t];case"down":return[n[0],(n[1]+o)%t];case"left":return n[0]-o<0?[l-Math.abs(n[0]-o)%l,n[1]]:[Math.abs(n[0]-o%l),n[1]];case"right":return[(n[0]+o)%l,n[1]]}}document.onkeydown=n=>{switch(n.preventDefault(),n.stopPropagation(),n.key){case"ArrowUp":if(c==="down")return;c="up";break;case"ArrowDown":if(c==="up")return;c="down";break;case"ArrowLeft":if(c==="right")return;c="left";break;case"ArrowRight":if(c==="left")return;c="right";break}};const y=a.width/i,b=a.height/i;let w=!1;const u=[[Math.floor(Math.random()*y),Math.floor(Math.random()*b)]];function m(n){const o=new Image;return o.src=`/snake-game/corner-${n}.png`,o}const D={left:m("left"),right:m("right"),up:m("up"),down:m("down")},I={up:"down",down:"up",left:"right",right:"left"};let p=c,A=Array(y).fill(Array(b).fill("up"));function M(n,o,l,t){return n===l?o<t?"down":"up":n<l?"right":"left"}async function L(){e.slice(1).findIndex(t=>t[0]===e[0][0]&&t[1]===e[0][1])!==-1&&(w=!0,document.body.prepend(document.createTextNode("You lost! Your score was "+e.length)),await new Promise(t=>setTimeout(t,1e3)),w=!1,e=[[0,0]],h=3),f.clearRect(0,0,a.width,a.height),f.fillStyle="gold";for(const[t,r]of u)f.fillRect(t*i+7,r*i+7,9,9);if(f.fillStyle="lightgreen",e[0][0]===u[0][0]&&e[0][1]===u[0][1]){for(;e.findIndex(s=>s[0]===u[0][0]&&s[1]===u[0][1])!==-1;)u[0]=[Math.floor(Math.random()*y),Math.floor(Math.random()*b)];console.log(u[0]);let t;e.length>=2?t=M(...e[e.length-1],...e[e.length-2]):t=c;const r=T(e[e.length-1],1,a.width/i,a.height/i,I[t]);e.push(r),h=Math.min(15,3+e.length*3/4),console.log("setting fps to",h)}for(let t=0;t<e.length;t++){const[r,s]=e[t];if(console.log(r,s),t===0)f.drawImage(D[p],r*i,s*i,i,i);else if(t===e.length-1){const d=M(...e[e.length-1],...e[e.length-2]);f.drawImage(D[I[d]],r*i,s*i,i,i)}else f.fillRect(r*i,s*i,i,i)}let n=e.slice(0,e.length-1);n[0]=T(e[0],1,a.width/i,a.height/i,c);for(let t=1;t<e.length;t++)n[t]=e[t-1];A[e[0][0]][e[0][1]]=p,e=n,console.log(e.slice(1,e.length-1).indexOf(e[0]));const o=performance.now(),l=o-P;g++,l>300&&(x.innerText=`FPS: ${Math.round(g/(l/300))}`,P=o,g=0),p=c}function O(){return setTimeout(()=>{w||L(),setTimeout(O,1e3/h)},1e3/h)}O();
